@model PaginadorModel
<br />
<div class="row">
    <div class="panel-heading">
        <div class="col-sm-12">
            @using (Html.BeginForm("GetExcelEstadoCtaCorriente", "ContabilidadAuxiliares", FormMethod.Post))
            {
                <div class="pull-right">
                    <br />
                    <button @*@(Model == null || Model.Count == 0 ? "disabled" : string.Empty)*@ class="btn btn-success waves-effect waves-light pull-right" value="Exportar" name="Save" type="submit" data-animation="fadein" data-plugin="custommodal" data-overlaySpeed="200" data-overlayColor="#36404a">
                        <span class="btn-label"><i class="fa fa-file-excel-o"></i></span>Exportar
                    </button>
                    <br />
                </div>
                <br />
            }
            <h2 class="page-header">Estado de Cuentas Corrientes</h2>
            <ol class="breadcrumb">
                <li>
                    <a href="#">Contabilidad Reportes</a>
                </li>
                <li>
                    <a href="#">-</a>
                </li>
                <li class="active">
                    Estado de Cuentas Corrientes
                </li>
            </ol>
        </div>
    </div>
</div>
<br />

<div class="form-group">
    <div class="row">
        <div class="card-box">
            @using (Html.BeginForm("EstadoCtasCorrientes", "ContabilidadAuxiliares", FormMethod.Post))
            {
                <div class="row form-group">
                    <div class="col-md-2">
                        <label>Cantidad de Registros</label>
                        <select class="form-control" id="cantidadRegistrosPorPagina" name="cantidadRegistrosPorPagina">
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="0">Todos</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label>Cuenta Contable</label>
                        <select class="form-control" id="CuentaAuxiliar" name="CuentaAuxiliar">
                            <option>Selecciona</option>
                            @foreach (CuentaContableModel CtaAux in ViewBag.lstCtasCtes)
                            {
                              <option value="@CtaAux.CuentaContableModelID">@CtaAux.nombre</option>
                            } 
                        </select>
                    </div>
                    <div class="col-lg-2 form-group">
                        <label class="control-label">Año</label>
                        <input type="number" class="form-control" name="Anio" id="Anio" value="" />
                    </div>
                    <div class="col-md-2 form-group">
                        <label for="" class="control-label">Mes</label>
                        <select name="Mes" id="Mes" class="form-control">
                            <option value="0">Todos</option>
                            <option value="1">Enero</option>
                            <option value="2">Febrero</option>
                            <option value="3">Marzo</option>
                            <option value="4">Abril</option>
                            <option value="5">Mayo</option>
                            <option value="6">Junio</option>
                            <option value="7">Julio</option>
                            <option value="8">Agosto</option>
                            <option value="9">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                    </div>
                    <div class="col-lg-2 form-group">
                        <label class="control-label">Rut</label>
                        <input type="text" class="form-control" id="Rut" name="Rut" maxlength="10" />
                    </div>
                    <div class="col-lg-2 form-group">
                        <label class="control-label">Razon Social</label>
                        <input type="text" class="form-control" id="RazonSocial" name="RazonSocial" />
                    </div>
                    <div class="col-lg-2 form-group">
                        <label class="control-label">Folio</label>
                        <input class="form-control" type="number" name="Folio" id="Folio" value="" />
                    </div>
                    <div class="col-lg-2 form-group">
                        <label class="control-label">Fecha Inicio</label>
                        <input type="text" class="form-control date" name="FechaInicio" id="FechaInicio" autocomplete="off" />
                    </div>
                    <div class="col-lg-2 form-group">
                        <label class="control-label">Fecha Fin</label>
                        <input type="text" class="form-control date" name="FechaFin" id="FechaFin" autocomplete="off" />
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-success centrar" id="Guardar" name="Guardar">Buscar</button>
                    </div>
                </div>
            }
              
            <div class="table-rep-plugin">
                <div class="table table-responsive">
                    <div class="panel-body" id="parshial" style="font-size:13px;">

                       
                        @{ List<string> lstNombresCtasAux = ParseExtensions.ObtieneLstAuxNombre(Model.LstCtasCorrientes);

                            decimal TotalDebe = 0;
                            decimal TotalHaber = 0;
                            decimal TotalSaldo = 0;
                            if(lstNombresCtasAux != null)
                            {
                                for (int i = 0; i < lstNombresCtasAux.Count(); i++)
                                {

                                    <h3>@lstNombresCtasAux[i]</h3>
                                    <table class="table table-responsive table-striped table-bordered table-hover compact" id="dataTables">
                                        <thead>
                                            <tr>
                                                <th class="FontSize">#</th>
                                                <th class="FontSize">Rut</th>
                                                <th class="FontSize">Nombre</th>
                                                <th class="FontSize">Fecha</th>
                                                <th class="FontSize">Comprobante</th>
                                                <th class="FontSize">Documento</th>
                                                <th class="FontSize">Vencim</th>
                                                <th class="FontSize">Debe</th>
                                                <th class="FontSize">Haber</th>
                                                <th class="FontSize">Saldo</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @{int correlativo = 0;}
                                            @{decimal Haber = 0;}
                                            @{decimal Debe = 0;}
                                            
                                           @foreach (var ItemCtaCorriente in Model.LstCtasCorrientes)
                                           {
                                               if (ItemCtaCorriente.CuentaContable.nombre == lstNombresCtasAux[i]) {
                                                   correlativo++;
                                                   <tr>
                                                       <td>@correlativo</td>
                                                       <td>@ItemCtaCorriente.RutPrestador</td>
                                                       <td>@ItemCtaCorriente.NombrePrestador</td>
                                                       <td>@ParseExtensions.ToDD_MM_AAAA(ItemCtaCorriente.Fecha)</td>
                                                       <td>@ItemCtaCorriente.Comprobante</td>
                                                       <td>@ItemCtaCorriente.Documento</td>
                                                       <td></td>
                                                       <td>
                                                            @{Debe += ItemCtaCorriente.Debe;}
                                                            @ParseExtensions.NumeroConPuntosDeMiles(ItemCtaCorriente.Debe)
                                                       </td>
                                                       <td>
                                                            @{Haber += ItemCtaCorriente.Haber;} 
                                                            @ParseExtensions.NumeroConPuntosDeMiles(ItemCtaCorriente.Haber)
                                                       </td>
                                                       <td>@ParseExtensions.NumeroConPuntosDeMiles(ItemCtaCorriente.Saldo)</td>
                                                   </tr>
                                                }
                                            }
                                        </tbody>
                                        <tr>
                                            <th class="FontSize text-center" colspan="6"></th>
                                            <th class="FontSize text-right"><b>TOTAL</b></th>
                                            <th class="FontSize text-right"><b>@ParseExtensions.NumeroConPuntosDeMiles(Debe)</b></th>
                                            <th class="FontSize text-right"><b>@ParseExtensions.NumeroConPuntosDeMiles(Haber)</b></th>
                                            @{decimal total = Haber - Debe;}
                                            <th class="FontSize text-right"><b>@ParseExtensions.NumeroConPuntosDeMiles(Math.Abs(total))</b></th>
                                            @{ 
                                                TotalHaber += Haber;
                                                TotalDebe += Debe;
                                                TotalSaldo += total;
                                            }
                                        </tr>
                                    </table>
                                                    }
                                                }

                                        <table class="table table-responsive table-bordered table-hover" id="dataTables-example">
                                            <thead>
                                                <tr>
                                                    <th class="FontSize text-center">-</th>
                                                    <th class="FontSize text-center">TOTAL</th>
                                                    <th class="FontSize text-center">DEBE</th>
                                                    <th class="FontSize text-center">HABER</th>
                                                    <th class="FontSize text-center">SALDO</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                    <tr>
                                                        <td colspan="2"></td>
                                                        <td class="FontSize text-center"><b>@ParseExtensions.NumeroConPuntosDeMiles(TotalDebe)</b></td>
                                                        <td class="FontSize text-center"><b>@ParseExtensions.NumeroConPuntosDeMiles(TotalHaber)</b></td>
                                                        <td class="FontSize text-center"><b>@ParseExtensions.NumeroConPuntosDeMiles(TotalSaldo)</b></td>
                                                    </tr>
                                            </tbody>
                                        </table>
                        }
                        @{Html.RenderPartial("_paginador", Model); }
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>

<style>
    .centrar{
        margin-top:25px;
    }
</style>